generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* -------------------------------------------------------------------------- */
/*  ENUMS â€“ Fixed options for applicant forms                                */
/* -------------------------------------------------------------------------- */
enum Track {
  FRONTEND
  BACKEND
  FULLSTACK_DEVELOPMENT
  MOBILE_DEVELOPMENT
  DATA_SCIENCE
  MACHINE_LEARNING
  DATA_ANALYSIS
  DATA_ENGINEERING
  UI_DESIGN
  UX_DESIGN
  GRAPHICS_DESIGN
  UX_RESEARCH
  PRODUCT_MARKETING_MANAGEMENT
  OPERATIONS
  SALES
  BUSINESS_DEVELOPMENT
  PROJECT_PRODUCT_MANAGEMENT
}

enum ReferralSource {
  TWITTER
  LINKEDIN
  INSTAGRAM
  FACEBOOK
  FRIEND
  OTHER
}

enum FrontendTool {
  REACT
  VUE
  ANGULAR
  SVELTE
  OTHER
}

enum BackendTool {
  NODE
  EXPRESS
  DJANGO
  FASTAPI
  LARAVEL
  OTHER
}

enum MobileTool {
  FLUTTER
  REACT_NATIVE
  KOTLIN
  SWIFT
  OTHER
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  SHORTLISTED
  ASSESSMENT_SENT
  ASSESSMENT_SUBMITTED
  INTERVIEW_SCHEDULED
  INTERVIEW_PASSED
  REJECTED
  ACCEPTED
}

/* -------------------------------------------------------------------------- */
/*  LOOKUP TABLES                                                            */
/* -------------------------------------------------------------------------- */
model Role {
  id        String    @id @default(uuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  users     UserRole[]
}

/* -------------------------------------------------------------------------- */
/*  CORE MODELS                                                              */
/* -------------------------------------------------------------------------- */
model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  firstName String
  lastName  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  roles       UserRole[]
  student     StudentProfile?
  mentor      MentorProfile?
  admin       AdminProfile?
}

model Application {
  id                  String         @id @default(uuid())

  firstName String
  lastName String
  email  String  @unique

  phoneNumber         String         @unique
  city                String
  track               Track

  frontendTools       FrontendTool[] @default([])
  frontendToolsOther  String[]       @default([])
  backendTools        BackendTool[]  @default([])
  backendToolsOther   String[]       @default([])
  mobileTools         MobileTool[]   @default([])
  mobileToolsOther    String[]       @default([])

  referralSource      ReferralSource
  referralSourceOther String?

  status              ApplicationStatus @default(PENDING)

  assessments         Assessment[]
  interviews          Interview[]

  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
}

/* -------------------------------------------------------------------------- */
/*  MANY-TO-MANY                                                             */
/* -------------------------------------------------------------------------- */
model UserRole {
  userId String
  roleId String

  user   User @relation(fields: [userId], references: [id])
  role   Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
}

/* -------------------------------------------------------------------------- */
/*  ONE-TO-MANY                                                              */
/* -------------------------------------------------------------------------- */
model Assessment {
  id              String      @id @default(uuid())
  applicationId   String
  application     Application @relation(fields: [applicationId], references: [id])

  assessmentLink  String?
  submissionLink  String?
  sentAt          DateTime?
  submittedAt     DateTime?
  reviewedAt      DateTime?

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model Interview {
  id             String            @id @default(uuid())
  applicationId  String
  application    Application       @relation(fields: [applicationId], references: [id])

  status         ApplicationStatus  @default(SHORTLISTED)
  interviewDate  DateTime
  notes          String?

  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
}

/* -------------------------------------------------------------------------- */
/*  PROFILES                                                                 */
/* -------------------------------------------------------------------------- */
model AdminProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model StudentProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MentorProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}